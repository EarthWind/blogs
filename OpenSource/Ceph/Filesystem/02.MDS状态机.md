# MDS状态
> MDS在使用中会存在多种状态
## 状态描述
#### 一般状态
```
up:active
```
> 这是MDS的基本状态，表示MDS当前是正常可用的，可以为客户端提供正常的文件系统服务

```
up:standby
```
> MDS处于备份模式，在主MDS出现问题的时候，会接替成为主MDS；一般在Monitor会将恢复正常的MDS设置为该状态；这种模式下不会同步主MDS的数据，所以在主MDS出现异常时恢复的时间会比较长；

```
up:standby_replay
```
> 备MDS会同步主MDS的日志，这样在主MDS出现问题时备份MDS可以更快的重放日志，然后成为主MDS；缺点是该MDS只能取代其追随的主MDS，当其他的MDS出现异常时，它不能接替其他MDS成为主MDS；

#### 其他状态
```
up:boot
```
> 在启动期间该状态会广播给Monitor，该状态不会出现在MDS集群中，因为会立即赋予MDS一个rank或将MDS设置为备份模式；

```
up:creating
```
> 创建新的rank让后加入MDS集群

```
up:starting
```
> MDS在启动一个停止的rank

```
up:stopping
```
> 当一个rank停止的时候，Monitor会命令MDS进入该状态；MDS不会接收新的客户端连接，将文件系统的子树合并都其他的rank，将元素据日志刷入磁盘，如果rank为0，则会关闭所有客户端的连接；


```
up:replay
```
> 该状态代表一个备MDS正在取代主MDS并且正在恢复日志；

```
up:resolve
```
> 如果文件系统是多活情况下MDS回从up:replay状态进入该状态，用于解决跨多个MDS出现权威元数据分歧得场景

```
up:reconnect
```
> MDS可能从replay或resolve状态进入该状态，此状态是请求客户端重新连接，任何和MDS存在session的客户端都需要在mds_reconnect_timeout时间内重新连接；

```
up:rejoin
```
> MDS把客户端inode加载到cache

```
up:clientreplay
```
> 处理up:reconnect阶段客户端发送过来得请求，这些请求是MDS已经返回给客户端了，但是请求还没有加入到Journal内，MDS进入up:active后会再次回复客户端；MDS会从up:rejoin进入该状态，

#### 失败状态
```
down:failed
```

```
down:damaged
```

```
down:stopped
```

![图1](http://qbwtbolro.bkt.clouddn.com/ceph/cephfs-mds-stat.webp)
> 图1，MDS状态转移图